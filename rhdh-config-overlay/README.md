# RHDH-Local Configuration Overlay

This directory contains configuration overrides for rhdh-local that enable Kuadrant plugin development.

## Files

- `app-config.local.yaml` - RHDH app configuration overrides
- `.env` - Environment variables (KUBECONFIG path)
- `kubeconfig.yaml` - Kubernetes cluster credentials (auto-generated, not in git)
- `toystore.yaml` - Catalog entities for Toystore demo

## How It Works

Following [rhdh-local best practices](https://github.com/redhat-developer/rhdh-local), we use the configs overlay approach:

1. **app-config.local.yaml** → Copied to `rhdh-local/configs/app-config/`
   - Sets base_url to http://localhost:7008
   - Registers Toystore catalog entities

2. **.env** → Copied to `rhdh-local/.env`
   - Sets KUBECONFIG environment variable
   - Points to kubeconfig in configs/extra-files/

3. **kubeconfig.yaml** → Copied to `rhdh-local/configs/extra-files/.kube/config`
   - Kubernetes credentials for kind cluster
   - Auto-generated by `make rhdh-kubeconfig`
   - Mounted automatically via configs/ directory

4. **toystore.yaml** → Copied to `rhdh-local/configs/catalog-entities/`
   - Demo API and component entities
   - Includes Kuadrant annotations

## Setup

Normal workflow (recommended):

```bash
# First time: initialize rhdh-local submodule and copy overlay files
make rhdh-submodule-init
make rhdh-setup

# Create cluster with Kuadrant
make kind-create

# Start RHDH with plugins
make dev
```

**What happens:**
- `make rhdh-submodule-init` - Clones rhdh-local as a Git submodule
- `make rhdh-setup` - Copies app-config.local.yaml, toystore.yaml, and .env to rhdh-local
- `make kind-create` - Creates cluster, generates kubeconfig, installs Kuadrant
- `make dev` - Builds/exports plugins and starts RHDH

**After cluster recreation:**
```bash
make kind-create  # Automatically regenerates kubeconfig
make dev
```

The `make dev` target checks if the cluster exists and regenerates kubeconfig if needed.

## Configuration Changes

To update RHDH configuration:

1. Edit files in `rhdh-config-overlay/`
2. Run `make rhdh-setup` to copy to rhdh-local
3. Run `make deploy` to rebuild plugins and restart RHDH

**Note:** Changes to app-config.local.yaml or .env require restarting RHDH.

## Port Configuration

RHDH runs on port **7008** (mapped from internal 7007). This is configured via:
- Docker Compose port mapping: `7008:7007`
- `BASE_URL` environment variable in compose.yaml
- `app-config.local.yaml` baseUrl setting

## Why This Approach?

- Clean Git submodule updates (rhdh-local tracked separately)
- Configuration separate from runtime
- Kubeconfig auto-mounted via configs/ directory
- Easy to update/regenerate cluster credentials
- Minimal compose.yaml modifications required (port mapping, network, BASE_URL)
